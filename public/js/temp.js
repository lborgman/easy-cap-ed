javascript:'use strict';
/* @license Copyright 2017 Lennart Borgman (lennart dot borgman at gmail dot com) All rights reserved. */
function getYTtimedtextURL() { var ret; resources = performance.getEntriesByType('resource'); resources.forEach(function(r){ if (r.name.match('timedtext')) { console.log('r.name', r.name); ret = r.name; } }); return ret; } function getYouTubeIdFromURL(ytURL) { var re = new RegExp('(?:[=/]|^)'+'((?:[A-Z0-9_-]){11})(?:[?&#\n]|$)', 'ig'); var m2 = re.exec(ytURL); console.log('m2', m2); if (m2) return m2[1]; } run: { if (location.href.match(/\/cap-bm\.html$/)) { alert('Please drag the bookmarklet to the bookmarks bar. %F0%9F%90%B5'); break run; } var capEdURL = 'http://dummy/path/caped-editor.html'; var tempA = document.createElement('a'); tempA.href = capEdURL; tempA.protocol = 'http:'; tempA.host = 'localhost:5000'; tempA.pathname = '/caped-editor.html'; if (!location.hostname.match(/\.youtube\.com$/)) { if (confirm('Please go to YouTube and open your video. %F0%9F%A6%81\nThen start this bookmarklet again.' +'\n\nOr, perhaps you wanted to go to the EasyCapEd editor?')) location.href = tempA.href; break run; } var ytId = getYouTubeIdFromURL(location.href); if (!ytId) { alert('Please choose a video. %F0%9F%90%B6\nThen start this bookmarklet again.'); break run; } let ytTitle = document.head.querySelector('title').innerText; var urlTT; /* Check for html5 */ var video = document.querySelector('video'); if (video) { var tracks = video.querySelectorAll('track'); for (var i=0; i<tracks.length; i++) { var track = tracks[i]; var src = track.getAttribute('src');  if (src.match('timedtext')) { urlTT = src; } } } urlTT = urlTT || getYTtimedtextURL(); if (!urlTT) { alert('Please turn on the auto-generated captions you want. %F0%9F%A6%84\nThen start this bookmarklet again.'); break run; } urlTT = urlTT.replace(new RegExp('fmt=vtt'), 'fmt=srv3'); if (!confirm('Open this in EasyCapEd? %F0%9F%91%B7%E2%80%8D%E2%99%80%EF%B8%8F')) break run; var goURL = tempA.href+'?ytId='+ytId+'&ytTimedText='+encodeURIComponent(urlTT)+'&ytTitle='+ytTitle; window.open(goURL); } ; void 0;
